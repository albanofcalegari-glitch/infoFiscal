<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Consulta Factura Cliente</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='estudio.css') }}">
</head>
<body>
    <div class="header" style="position:relative;">
        <div style="display:flex; align-items:center; justify-content:space-between;">
            <div style="min-width:140px;">
                <a href="/home" style="color:#fff; text-decoration:none; font-weight:700; font-size:1.15em; padding:4px 10px; border-radius:4px;">InfoFiscal</a>
            </div>
            <div style="flex:1;"></div>
            <div style="position:relative;">
                <div class="user-menu" style="display:inline-block; position:relative;">
                    <button id="userBtn" style="background:none; border:none; cursor:pointer; font-size:1em; padding:0; margin:0;">
                        <span style="vertical-align:middle; font-size:1.1em;">üë§</span>
                    </button>
                    <div id="userDropdown" style="display:none; position:absolute; right:0; background:#fff; border:1px solid #bfc9d1; border-radius:5px; box-shadow:0 2px 8px rgba(26,53,94,0.10); min-width:120px; z-index:10; font-size:0.95em;">
                        <div style="padding:7px 12px; border-bottom:1px solid #eee; color:#1a355e; font-weight:500;">{{ usuario }}</div>
                        <a href="{{ url_for('logout') }}" style="display:block; padding:7px 12px; color:#c00; text-decoration:none; font-weight:500;">Cerrar sesi√≥n</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
    const userBtn = document.getElementById('userBtn');
    const userDropdown = document.getElementById('userDropdown');
    userBtn.addEventListener('mouseenter', () => {
        userDropdown.style.display = 'block';
    });
    userBtn.addEventListener('mouseleave', () => {
        setTimeout(() => { if (!userDropdown.matches(':hover')) userDropdown.style.display = 'none'; }, 200);
    });
    userDropdown.addEventListener('mouseleave', () => {
        userDropdown.style.display = 'none';
    });
    userDropdown.addEventListener('mouseenter', () => {
        userDropdown.style.display = 'block';
    });
    </script>
    <div class="main-container" style="margin-top:40px; max-width:98vw;">
        <h2>Datos del cliente seleccionado</h2>
        <div style="overflow-x:auto; width:100%;">
            <table style="min-width:700px; width:100%; border-collapse:collapse; background:#fff; box-shadow:0 2px 8px rgba(26,53,94,0.08);">
                <thead>
                    <tr style="background:#f3f6fa; color:#1a355e;">
                        <th style="padding:10px 8px; border-bottom:1px solid #bfc9d1;">Tipo Doc</th>
                        <th style="padding:10px 8px; border-bottom:1px solid #bfc9d1;">Nro Doc</th>
                        <th style="padding:10px 8px; border-bottom:1px solid #bfc9d1;">Apellido</th>
                        <th style="padding:10px 8px; border-bottom:1px solid #bfc9d1;">Nombres</th>
                        <th style="padding:10px 8px; border-bottom:1px solid #bfc9d1;">CUIT</th>
                        <th style="padding:10px 8px; border-bottom:1px solid #bfc9d1;">Fecha Nac.</th>
                        <th style="padding:10px 8px; border-bottom:1px solid #bfc9d1;">Condici√≥n IVA</th>
                        <th style="padding:10px 8px; border-bottom:1px solid #bfc9d1;">Categor√≠a Monotributo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding:8px 6px; border-bottom:1px solid #eee;">{{ cliente.tipoDocumento }}</td>
                        <td style="padding:8px 6px; border-bottom:1px solid #eee;">{{ cliente.nroDocumento }}</td>
                        <td style="padding:8px 6px; border-bottom:1px solid #eee;">{{ cliente.apellido }}</td>
                        <td style="padding:8px 6px; border-bottom:1px solid #eee;">{{ cliente.nombres }}</td>
                        <td style="padding:8px 6px; border-bottom:1px solid #eee;">{{ cliente.CUIT or cliente.cuit }}</td>
                        <td style="padding:8px 6px; border-bottom:1px solid #eee;">{{ cliente.fechaNacimiento }}</td>
                        <td style="padding:8px 6px; border-bottom:1px solid #eee;">{{ cliente.condicionIVA }}</td>
                        <td style="padding:8px 6px; border-bottom:1px solid #eee;">{{ cliente.categoriaMonotriibuto }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div style="margin-top:32px; display:flex; justify-content:center;">
            <button id="descargarFacturasBtn" style="height:44px; min-width:180px; font-size:1rem; font-weight:700; border-radius:5px; background:#1a355e; color:#fff; border:none; cursor:pointer;">Descargar facturas</button>
        </div>
        <script>
        document.getElementById('descargarFacturasBtn').onclick = function() {
            // Ejemplo de invocaci√≥n al backend para descargar facturas emitidas por el CUIT del cliente
            // Aqu√≠ se asume que existe un endpoint /descargar-facturas que recibe el CUIT
            const cuit = '{{ cliente.CUIT or cliente.cuit }}';
            fetch('/descargar-facturas?cuit=' + encodeURIComponent(cuit))
                .then(r => r.ok ? r.blob() : Promise.reject('Error al descargar'))
                .then(blob => {
                    // Descargar el archivo (ejemplo: ZIP o PDF)
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'facturas_' + cuit + '.zip';
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                })
                .catch(err => alert(err));
        };
        </script>
    </div>
</body>
</html>
